<template>
  <div class="form">
    <div class="form_container">
      <div class="form_title">
        –û—Å—Ç–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É –∏ –º—ã –ø—Ä–æ–≤–µ–¥—ë–º<br />–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é –±–µ—Å–ø–ª–∞—Ç–Ω–æ
      </div>
      <div class="form_elements">
        <div class="form_items">
          <el-form
            ref="ruleFormRef"
            :model="ruleForm"
            :rules="rules"
            label-position="top"
            class="rule_form"
          >
            <div class="form_row">
              <el-form-item prop="name">
                <template #label>
                  –í–∞—à–µ –∏–º—è <span style="color: red">*</span>
                </template>
                <el-input
                  v-model="ruleForm.name"
                  placeholder="–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤"
                ></el-input>
              </el-form-item>
              <el-form-item prop="email">
                <template #label>
                  –í–∞—à–∞ –ø–æ—á—Ç–∞ <span style="color: red">*</span>
                </template>
                <el-input
                  v-model="ruleForm.email"
                  placeholder="example@mail.ru"
                ></el-input>
              </el-form-item>
            </div>
            <div class="form_row">
              <el-form-item prop="phone">
                <template #label>
                  –í–∞—à —Ç–µ–ª–µ—Ñ–æ–Ω <span style="color: red">*</span>
                </template>
                <el-input
                  v-model="ruleForm.phone"
                  type="tel"
                  maxlength="16"
                  placeholder="+7XXXXXXXXXX"
                ></el-input>
              </el-form-item>
              <el-form-item label="–ß—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–∫–∞–∑–∞—Ç—å">
                <el-input
                  type="textarea"
                  v-model="ruleForm.area"
                  placeholder="–í–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"
                ></el-input>
              </el-form-item>
            </div>
            <div class="form_actions">
              <el-form-item prop="agree">
                <el-checkbox v-model="ruleForm.agree">
                  –Ø —Å–æ–≥–ª–∞—Å–µ–Ω –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                </el-checkbox>
              </el-form-item>
              <el-form-item class="form_button">
                <el-button type="primary" @click="submitForm" id="button"
                  >–û–¢–ü–†–ê–í–ò–¢–¨</el-button
                >
              </el-form-item>
            </div>
          </el-form>
        </div>
        <div class="form_photo">
          <img src="@/assets/form_people.png" alt="" />
        </div>
      </div>
    </div>
  </div>
  <footer class="footer">
    <div class="footer_container">
      <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –õ–æ–≥–æ—Ç–∏–ø + –ö–æ–Ω—Ç–∞–∫—Ç—ã -->
      <div class="footer_column logo_and_contacts">
        <div class="footer_logo">
          <router-link to="/" class="logo-link">
            <img src="@/assets/INOY_logo.png" alt="inoy" />
            <div>marketing agency</div>
          </router-link>
        </div>
        <div class="footer_contacts">
          <p>
            <strong>–¢–µ–ª–µ—Ñ–æ–Ω: </strong
            ><a href="tel:+79155459585">+7 (915) 545-95-85</a>
          </p>
          <p>
            <strong>–ü–æ—á—Ç–∞: </strong
            ><a href="mailto:inoyagency@gmail.com">inoyagency@gmail.com</a>
          </p>
          <p><strong>–ê–¥—Ä–µ—Å: </strong>–≥. –í–æ—Ä–æ–Ω–µ–∂</p>
        </div>
      </div>

      <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞: –ú–µ–Ω—é -->
      <div class="footer_column menu">
        <div class="footer_nav_group">
          <div class="footer_nav_title">–ù–∞–≤–∏–≥–∞—Ü–∏—è</div>
          <p><a href="/">–ì–ª–∞–≤–Ω–∞—è</a></p>
          <p><a href="/about">–û –Ω–∞—Å</a></p>
          <p><a href="/cases">–ö–µ–π—Å—ã</a></p>
          <p><a href="/contacts">–ö–æ–Ω—Ç–∞–∫—Ç—ã</a></p>
        </div>
        <div class="footer_nav_group">
          <div class="footer_nav_title">–£—Å–ª—É–≥–∏</div>
          <p><a href="/services/setup">–†–∞–∑–æ–≤–∞—è —Ç–µ—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞</a></p>
          <p><a href="/services/site">–≠–∫—Å–ø—Ä–µ—Å—Å-—Å–∞–π—Ç</a></p>
          <p><a href="/services/audit">–¢–æ—á–Ω–æ-–≤-—Ü–µ–ª—å –ê—É–¥–∏—Ç</a></p>
          <p><a href="/services/marketing">–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥ –ø–æ–¥ –∫–ª—é—á</a></p>
        </div>
      </div>

      <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞: –°–æ—Ü—Å–µ—Ç–∏ -->
      <div class="footer_column footer_socials">
        <div class="social_links horizontal">
          <!-- –∏–ª–∏ horizontal -->
          <a href="https://t.me/cylimova" target="_blank" aria-label="Telegram">
            <img src="@/assets/icons/telegram.png" alt="Telegram" />
          </a>
          <a href="https://vk.com/cylimova" target="_blank" aria-label="VK">
            <img src="@/assets/icons/vk.png" alt="VK" />
          </a>
          <a
            href="https://instagram.com/cylimova"
            target="_blank"
            aria-label="Instagram"
          >
            <img src="@/assets/icons/instagram.png" alt="Instagram" />
          </a>
        </div>
        <div class="social_for_inst">
          *Instagram, –ø—Ä–æ–¥—É–∫—Ç –∫–æ–º–ø–∞–Ω–∏–∏ Meta, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–∑–Ω–∞–Ω–∞ —ç–∫—Å—Ç—Ä–µ–º–∏—Å—Ç—Å–∫–æ–π
          –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–µ–π –≤ –†–æ—Å—Å–∏–∏
        </div>
      </div>
    </div>

    <!-- –ö–æ–ø–∏—Ä–∞–π—Ç -->
    <div class="footer_bottom">
      ¬© InoyAgency, {{ new Date().getFullYear() }}. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.
    </div>
  </footer>
</template>

<script setup lang="ts">
import { ref } from 'vue'
import { ElMessage } from 'element-plus'
import { useFetch } from '#app'

const ruleFormRef = ref()
const ruleForm = ref({
  name: '',
  email: '',
  phone: '',
  area: '',
  agree: false
})

const validateName = (rule: any, value: string, callback: any) => {
  if (!value) return callback(new Error("–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è"));
  const words = value.trim().split(" ");
  if (words.length < 2) return callback(new Error("–£–∫–∞–∂–∏—Ç–µ –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é"));
  const isCapitalized = words.every((word) => /^[–ê-–Ø–Å][–∞-—è—ë]+$/.test(word));
  if (!isCapitalized)
    return callback(new Error("–ö–∞–∂–¥–æ–µ —Å–ª–æ–≤–æ –¥–æ–ª–∂–Ω–æ –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å –∑–∞–≥–ª–∞–≤–Ω–æ–π –±—É–∫–≤—ã"));
  callback();
};

const validateEmail = (rule: any, value: string, callback: any) => {
  if (!value) return callback(new Error("–í–≤–µ–¥–∏—Ç–µ email"));
  const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  if (!regex.test(value)) return callback(new Error("–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email"));
  callback();
};

const validatePhone = (rule: any, value: string, callback: any) => {
  if (!value.startsWith("+7")) {
    return callback(new Error("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä —Å +7"));
  }
  const digitsOnly = value.replace(/\D/g, "");
  if (digitsOnly.length !== 11 || !digitsOnly.startsWith("7")) {
    return callback(new Error("–í–≤–µ–¥–∏—Ç–µ –≤–µ—Å—å –Ω–æ–º–µ—Ä –ø–æ—Å–ª–µ +7"));
  }
  callback();
};

const rules = {
  name: [{ validator: validateName, trigger: "blur" }],
  email: [{ validator: validateEmail, trigger: "blur" }],
  phone: [{ validator: validatePhone, trigger: "blur" }],
  agree: [
    {
      validator: (rule: any, value: boolean, callback: any) => {
        if (!value) {
          callback(new Error("–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö"));
        } else {
          callback();
        }
      },
      trigger: "change",
    },
  ],
}

const getOrSetUserId = (): string => {
  let id = localStorage.getItem("user_id")
  if (!id) {
    id = crypto.randomUUID()
    localStorage.setItem("user_id", id)
  }
  return id
}

const submitForm = async () => {
  if (!ruleFormRef.value) return

  await ruleFormRef.value.validate(async (valid: boolean) => {
    if (valid) {
      const response = await useFetch('http://localhost:3001/api/form', {
        method: 'POST',
        body: {
          ...ruleForm.value,
          user_id: getOrSetUserId() // üëà –¥–æ–±–∞–≤–ª–µ–Ω–æ
        }
      })

      if (response.data.value?.status === 'success') {
        ElMessage.success('–ó–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞!')
        ruleForm.value = {
          name: '',
          email: '',
          phone: '',
          area: '',
          agree: false
        }
      } else {
        ElMessage.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.')
      }
    }
  })
}

</script>

<style scoped>
.form {
  background: #62007b;
  padding: 80px 20px;
  color: white;
}
.form_container {
  max-width: 1200px;
  margin: 0 auto;
}
.form_title {
  font-size: 42px;
  font-weight: bold;
  text-align: center;
  line-height: 1.4;
  margin-bottom: 60px;
}
.form_elements {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  gap: 40px;
}
.form_items {
  flex: 1 1 50%;
  display: flex;
  flex-direction: column;
}
.rule_form {
  width: auto;
  text-align: left;
}
.form_row {
  display: flex;
  gap: 20px;
  margin-bottom: 20px;
}
.form_row .el-form-item {
  flex: 1;
}

.form_actions {
  display: flex;
  justify-content: flex-end; /* —Å–ø—Ä–∞–≤–∞ –Ω–∞ desktop */
  flex-direction: column;
}

/* –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤—Å–µ–≥–æ —ç–ª–µ–º–µ–Ω—Ç–∞ —Ñ–æ—Ä–º—ã */
::v-deep(.el-form-item) {
  margin-bottom: 24px;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è label */
::v-deep(.el-form-item__label) {
  font-weight: 600;
  font-size: 16px;
  color: #ffffff;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–ª—è –≤–≤–æ–¥–∞ */
::v-deep(.el-input__wrapper) {
  background-color: #ffffff;
  padding: 10px;
  font-size: 16px;
}
::v-deep(.el-input__wrapper input) {
  color: black;
}
::v-deep(.el-textarea__inner) {
  background-color: #ffffff;
  padding: 10px;
  font-size: 16px;
  color: black;
  border-radius: 8px;
  resize: vertical; /* –º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å resize, –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω–æ */
}

/* –°—Ç–∏–ª–∏ —á–µ–∫–±–æ–∫—Å–∞ */
::v-deep(.el-checkbox) {
  color: #ffffff;
  font-size: 14px;
}

::v-deep(.el-checkbox__input.is-checked .el-checkbox__inner) {
  background-color: #ff4500;
  border-color: #ff4500;
}

.form_button {
  margin-top: 30px;
}
.form_photo {
  flex: 1 1 45%;
  display: flex;
  align-items: center;
  justify-content: center;
}
.form_photo img {
  width: 100%;
  max-width: 520px;
  border-radius: 20px;
  object-fit: cover;
  border: 2px black solid;
}
/* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
@media (max-width: 768px) {
  .form_elements {
    flex-direction: column;
    align-items: center;
  }
  .form_row {
    flex-direction: column; /* –∏–∑–º–µ–Ω—è–µ–º –Ω–∞ –∫–æ–ª–æ–Ω–∫—É */
    gap: 10px;
    margin-bottom: 10px;
  }
  .form_title {
    line-height: 110%;
  }
  .form_actions {
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }
  .form_button {
    margin-top: 0px;
    width: 100%;
  }
  .form_button .el-button {
    min-width: 100%;
    height: 50px;
  }
}

.footer {
  background-color: #2a0030;
  color: white;
  padding: 60px 20px 40px;
  font-size: 16px;
}

.footer_container {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  gap: 60px;
  max-width: 1200px;
  margin: 0 auto;
  box-sizing: border-box;
}

.footer_column {
  flex: 1;
  min-width: 240px;
  max-width: 420px; /* –ø–æ –∂–µ–ª–∞–Ω–∏—é */
  text-align: left;
  box-sizing: border-box;
}
.footer_column.menu {
  flex: 420px; /* —Ñ–∏–∫—Å–∏—Ä—É–µ–º —à–∏—Ä–∏–Ω—É */
  display: flex;
  justify-content: space-between;
}
.footer_column.menu p {
  margin: 0;
}
.logo_and_contacts {
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  height: 100%;
  flex: 0 0 320px;
}

.footer_logo img {
  height: 40px;
  margin-right: 15px;
}
.logo-link {
  display: flex;
  align-items: center;
  text-decoration: none;
  color: inherit;
}

.footer_contacts {
  margin-top: 20px;
}
.footer_contacts p {
  margin-bottom: 12px;
  font-size: 16px;
  margin-top: 20px;
}
.footer_contacts a {
  color: white;
  text-decoration: underline;
}
.footer_nav_group {
  display: flex;
  flex-direction: column;
  gap: 18px;
}
.footer_nav_title {
  font-weight: bold;
  margin-top: 0;
  margin-bottom: 12px;
  font-size: 16px;
  color: #949494;
}
.footer_nav_group a {
  color: white;
  text-decoration: none;
}
.footer_nav_group a:hover {
  color: #ff4500;
}

.footer_column.footer_socials {
  flex: 0 0 240px; /* —Ñ–∏–∫—Å–∏—Ä—É–µ–º —à–∏—Ä–∏–Ω—É */
  display: flex;
  text-align: right;
}
.footer_socials {
  display: flex;
  flex-direction: column;
  gap: 18px;
  align-items: flex-end;
}
.social_links {
  display: flex;
  gap: 16px;
}

.social_links.vertical {
  flex-direction: column;
  align-items: flex-end;
}

.social_links.horizontal {
  flex-direction: row;
  justify-content: flex-end;
  align-items: center;
}

.social_links a {
  display: inline-block;
  width: 32px;
  height: 32px;
  transition: transform 0.2s ease;
}

.social_links a img {
  width: 100%;
  height: auto;
  display: block;
  filter: brightness(0.8);
}

.social_links a:hover {
  transform: scale(1.15);
}
.social_for_inst {
  font-size: 12px;
  color: #7c7c7c;
  margin-left: auto;
}

.footer_bottom {
  text-align: center;
  margin-top: 60px;
  font-size: 14px;
  color: #7c7c7c;
}

/* –ê–¥–∞–ø—Ç–∏–≤ */
@media (max-width: 1160px) and (min-width: 768px) {
  .footer_container {
    gap: 20px;
    justify-content: space-evenly;
  }
  .footer_socials {
    justify-content: center;
    margin: 0 auto;
    max-height: 200px;
  }
  .social_links.horizontal {
    justify-content: center;
  }
  .footer_column.footer_socials {
    width: 100%;
    max-width: 300px;
    max-height: 170px;
    margin: 0 auto;
    align-items: center;
    text-align: center;
    margin-top: 15px;
  }
}
@media (max-width: 768px) {
  .footer_container {
    display: flex;
    flex-direction: column;
    align-items: center; /* –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ—Ç –í–°–ï –¥–æ—á–µ—Ä–Ω–∏–µ –±–ª–æ–∫–∏ */
    justify-content: center;
    text-align: center;
    gap: 20px;
    padding: 0 20px;
  }
  .logo_and_contacts {
    justify-content: center;
    align-items: center;
  }

  .footer_column,
  .logo_and_contacts {
    width: 100%;
    max-width: 300px;
    max-height: 180px;
    margin: 0 auto;
    align-items: center;
    text-align: center;
    margin-top: 15px;
  }
  .footer_column.footer_socials {
    width: 100%;
    max-width: 300px;
    max-height: 160px;
    margin: 0 auto;
    align-items: center;
    text-align: center;
  }

  .footer_socials {
    justify-content: center;
    margin: 0 auto;
    max-height: 200px;
  }
  .social_links.horizontal {
    justify-content: center;
  }
  .footer_bottom {
    text-align: center;
    margin: 10px auto 0;
    width: 100%;
  }
}
</style>
